<div class="product">
    <span class='image'><%= @product.image.url %></span>
    <span class='title'><%= @product.title %></span>
    <span class='price'>  <%= @product.inet_price %> <s><%= @product.price %></s></span>
</div>
<div class="comments" ng-controller="CommentController">
  <form>
    <label>Username:</label>
    <input type="text" name="username" ng-model="newcomment.name" />
    <br />
    <label>E-mail:</label>
    <input type="email" name="useremail" ng-model="newcomment.email"/>
    <br />
    <label>Content:</label>
    <textarea name="content" ng-model="newcomment.content"></textarea>
    <button ng-click="addComment()">Add</button>
  </form>
  <ul>
    <li ng-repeat='comment in comments'>
      <span class='email'>{{comment.email}}</span>
      <span class='name'>{{comment.name}}</span>
      <p class='content'>
        {{comment.content}}
      </p>
    </li>
  </ul>
</div>

<script type="text/javascript">
    var myApp = angular.module('prod_import', ['infinite-scroll', 'ngResource']);

    myApp.config([
        "$httpProvider", function($httpProvider) {
            $httpProvider.defaults.headers.common['X-CSRF-Token'] = $('meta[name=csrf-token]').attr('content');
        }
    ]);

    myApp.factory('Comments', function($resource){
        return $resource('/products/<%= @product.id.to_s %>/comments/:commentId.json', {}, {});
    })
    .controller('CommentController', function($scope, Comments) {
        $scope.comments = Comments.query();
        $scope.addComment = function() {
            $scope.comments.push(angular.copy($scope.newcomment));
            Comments.save($scope.newcomment);
        }
    });

</script>